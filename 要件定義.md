# サーバースペックアップ管理システム 要件定義書

## 1. システム概要

### 1.1 背景

- ECサイト運用において、複数の開発案件が並行して進行
- 各案件で負荷試験時にサーバースペックアップが必要
- 従来は各担当者が個別に依頼を出していたため、以下の問題が発生：
  - 対象サーバーの案件間重複
  - スペックアップ料金計算の誤り

### 1.2 目的

案件ごとに必要なスペックアップ情報を一元管理し、以下を実現する：

- 料金の自動計算
- 案件横断でのスペックアップ対象抽出
- 稟議依頼文書の自動生成
- インフラ依頼チケットの自動生成

### 1.3 技術スタック

- **バックエンド**: Laravel
- **フロントエンド**: Laravel (Blade)
- **データベース**: MySQL
- **認証**: Firebase Authentication
- **デプロイ環境**: ローカル環境（将来的に社内サーバーまたはクラウド）

### 1.4 ユーザー権限

- **管理者**: 全案件の閲覧・編集・削除、稟議依頼作成、インフラ依頼作成、ユーザー管理が可能
- **一般ユーザー**: 自身で登録した案件のみ編集・削除が可能

## 2. 画面一覧と画面仕様

### 2.1 ログイン画面

#### 機能概要

- メールアドレスとパスワードでログイン
- サインアップ機能（メールアドレス、パスワード、ユーザー名を入力）
- パスワードリセット機能（メール認証）

#### 画面要素

- メールアドレス入力欄
- パスワード入力欄
- ログインボタン
- サインアップリンク
- パスワードを忘れた場合のリンク

#### バリデーション

- メールアドレス形式チェック
- パスワード必須チェック

### 2.2 共通ヘッダー

#### 画面要素

- ナビゲーションメニュー
  - TOP
  - マスタ管理（ドロップダウン）
    - 料金マスタ
    - 休日マスタ
    - サーバー名マスタ
  - 稟議依頼作成（管理者のみ）
  - インフラ依頼作成（管理者のみ）
  - ユーザー管理（管理者のみ）
- ユーザーアイコン（右側）
  - クリックでプルダウンメニュー表示
    - ユーザー名変更
    - パスワード変更
    - ログアウト

### 2.3 TOP画面

#### 機能概要

- 登録されている案件の一覧を表示
- 案件の詳細表示、編集、新規登録が可能

#### 画面要素

- 「案件新規登録」ボタン
- 「稟議依頼作成」ボタン（管理者のみ）
- 「インフラ依頼チケット作成」ボタン（管理者のみ）
- 「マイ案件のみ表示」チェックボックス

#### 案件一覧表示

- 表示順序：スペックアップ開始日の昇順（過去月分を除く）
- 過去月分：「過去月分を表示」エリアに折りたたみ
  - 過去月判定：スペックアップ終了日の月末が現在日時の月初より前
  - 例：終了日2026/2/15、現在2026/3/1 → 過去月
  - 例：終了日2026/2/15、現在2026/2/28 → 過去月ではない
- 各案件には「詳細」「編集」ボタンを配置

#### 詳細表示（アコーディオン形式）

- クリックで展開・折りたたみ
- 表示項目（各サーバーが1行）：
  - 案件名
  - 予算コード
  - クラウドサーバー名
  - サーバー名
  - 変更前スペック
  - 変更後スペック
  - スペックアップ開始日
  - スペックアップ終了日
  - 稼働時間
  - スペックアップ前金額（1日あたり）
  - スペックアップ後金額（1日あたり）
  - スペックアップ差額（1日あたり）
  - スペックアップ日数

#### マイ案件のみ表示

- チェックON：自身が登録した案件のみ表示
- チェック状態はローカルストレージで保持

#### 権限制御

- 一般ユーザー：自身の案件のみ編集ボタンが表示される
- 管理者：全案件の編集ボタンが表示される

### 2.4 案件登録画面

#### 機能概要

- 新規案件の登録
- サーバー情報を複数登録可能
- 料金自動計算機能

#### 基本情報入力欄

- 案件名（フリーテキスト、最大128文字）
- 予算コード（半角英数、最大7文字）

#### サーバー情報入力欄（複数セット入力可能）

各セットには以下の項目：

- クラウドサーバー名（選択式：ニフクラ/AWS）
- サーバー名（フリー入力＋オートコンプリート、半角英数記号、最大30文字）
  - サーバー名マスタから該当するクラウドサーバーのサーバー名をサジェスト表示
  - フリー入力可能だが、フォーカスアウト時にマスタに存在しない場合はエラー表示
  - マスタに存在する値のみ登録可能
- 変更前スペック（フリー入力＋オートコンプリート、半角英数記号、最大30文字）
  - 料金マスタから該当するクラウドサーバーのスペック名をサジェスト表示
  - フリー入力可能だが、フォーカスアウト時にマスタに存在しない場合はエラー表示
  - マスタに存在する値のみ登録可能
- 変更後スペック（フリー入力＋オートコンプリート、半角英数記号、最大30文字）
  - 料金マスタから該当するクラウドサーバーのスペック名をサジェスト表示
  - フリー入力可能だが、フォーカスアウト時にマスタに存在しない場合はエラー表示
  - マスタに存在する値のみ登録可能
- スペックアップ開始日（yyyy/mm/dd、カレンダー選択）
- スペックアップ終了日（yyyy/mm/dd、カレンダー選択）
- 稼働時間（選択式：09:00-18:00/24時間）
- 「複製」ボタン（このセットをコピー）
- 「削除」ボタン（2セット以上ある場合のみ有効）

#### 操作ボタン

- 「追加」ボタン（サーバー情報セット全体の下部）
- 「料金の計算」ボタン
- 「登録をやめる」ボタン

#### 料金計算フロー

1. 「料金の計算」ボタン押下
2. 料金マスタから該当スペックの料金を取得
3. 稼働時間と期間から営業日数を計算（土日祝日を除く）
   - 09:00-18:00の場合：1日9時間として計算
   - 24時間の場合：1日24時間として計算
4. 計算結果を保存（1日あたりの前金額、後金額、差額、日数）
5. 表示を変更：
   - 入力欄をロック
   - 「料金の計算」ボタンを非表示
   - 「表を修正」「登録」ボタンを表示

#### バリデーション

- 必須項目チェック（全項目必須）
- 文字数制限チェック
- 半角英数形式チェック（クライアント側・サーバー側両方）
- 料金取得エラー：
  - 変更前スペック名不正
  - 変更後スペック名不正
- 日付エラー：
  - 終了日が開始日より前

#### 登録をやめる機能

- いずれかの項目に入力がある場合：
  - 確認ダイアログ表示：「入力内容は保存されません。本当に登録をやめますか？」
  - 「登録をやめる」ボタン：TOP画面に戻る
  - 「キャンセル」ボタン：ダイアログを閉じる

#### 登録完了

- 「登録」ボタン押下で案件をデータベースに保存
- 正常完了後、TOP画面に戻る

### 2.5 案件編集画面

#### 機能概要

- 既存案件の編集
- 基本的な構成は案件登録画面と同じ

#### 画面要素

- 編集元データが初期値として表示される
- 「編集をやめる」ボタン（機能は「登録をやめる」と同じ）
- 「削除」ボタン（画面右上）

#### 料金再計算ロジック

- 料金関連項目（変更前/後スペック、開始/終了日、稼働時間）が変更された場合：
  - 「登録」ボタンを非活性化
  - ボタン上部に「料金関連項目を編集したため、料金の再計算が必要です」と表示
  - 「料金の計算」ボタンを押すまで登録不可
- 案件名、予算コード、サーバー名のみ変更：
  - 再計算不要、そのまま登録可能

#### 削除機能

- 「削除」ボタン押下時、確認ダイアログを表示
- 論理削除（削除フラグを立てる）
- 削除後、TOP画面に戻る

#### 権限制御

- 一般ユーザー：自身の案件のみアクセス可能
- 管理者：全案件にアクセス可能

### 2.6 稟議依頼作成画面

#### 機能概要

- 登録されている案件から対象月のスペックアップ情報を集計
- 稟議依頼文書を自動生成

#### 画面要素

- 対象年月入力欄（フリーテキスト、初期値：来月）
- 「稟議依頼を作成」ボタン
- 生成された稟議依頼文のテキストエリア
- 「コピー」ボタン

#### 作成ロジック

1. **対象案件抽出条件**：
   - スペックアップ開始日 ≦ 対象年月末
   - スペックアップ終了日 ≧ 対象年月初
   - 例：対象2026年3月 → 開始日 ≦ 2026/3/31 かつ 終了日 ≧ 2026/3/1

2. **金額計算**：
   - 対象月に含まれる営業日数のみカウント
   - 月を跨ぐ場合は日割り計算
   - 例：期間2026/2/20～2026/4/10、対象月3月 → 3/1～3/31の営業日数で計算

3. **案件間重複の考慮**：
   - 同じクラウドサーバー名 + サーバー名 + 期間重複
   - 重複時は1台分のみカウント
   - 変更後スペックの金額が異なる場合は高い方を採用

4. **出力内容**：
   - 案件ごとの明細表
   - 全案件横断の集計（重複除外済み）

#### 出力フォーマット

- プレーンテキスト
- 表形式はタブ区切りやスペース整形で見やすく表示
- 仮フォーマット：案件ごとの明細 + 合計金額
- ※後でフォーマット変更可能な設計

#### 権限制御

- 管理者のみアクセス可能

### 2.7 インフラ依頼チケット作成画面

#### 機能概要

- 稟議依頼作成とほぼ同様
- 出力フォーマットのみ異なる

#### 画面要素・ロジック

- 稟議依頼作成画面と同じ

#### 出力フォーマット

- プレーンテキスト
- 仮フォーマット：案件ごとの明細 + 合計金額
- ※後でフォーマット変更可能な設計

#### 権限制御

- 管理者のみアクセス可能

### 2.8 料金マスタ編集画面

#### 機能概要

- クラウドサーバーのスペック別料金を管理
- インライン編集形式
- CSV一括ダウンロード・アップロード機能

#### 画面要素

- 料金マスタ一覧表
  - クラウドサーバー名（ニフクラ/AWS）
  - スペック名
  - 料金（1時間あたり、税抜き）
    - ニフクラ：整数値、表示は「¥」を先頭に付与（例：¥100）
    - AWS：小数第四位まで、表示は「$」を先頭に付与（例：$0.0416）
  - 「編集」ボタン（各行）
  - 「削除」ボタン（各行）
- 「追加」ボタン（表の末尾）
- 「CSVダウンロード」ボタン
- 「CSVアップロード」ボタン

#### 操作

- 追加：表の末尾に新規行を追加、インライン編集
- 編集：該当行をインライン編集モードに変更
- 削除：物理削除、確認ダイアログ表示

#### CSVダウンロード機能

- CSV形式：クラウドサーバー名, スペック名, 料金（1時間あたり、税抜き）
  - クラウドサーバー名：「ニフクラ」または「AWS」
  - 料金：数値のみ（通貨記号なし）
- 現在登録されている全データをCSV形式でダウンロード
- ファイル名：price_masters_YYYYMMDD_HHmmss.csv

#### CSVアップロード機能

- CSV形式：クラウドサーバー名, スペック名, 料金（1時間あたり、税抜き）
  - クラウドサーバー名：「ニフクラ」または「AWS」
  - 料金：数値のみ（通貨記号なし）
- アップロードにより既存データを全て物理削除し、CSVの内容で置き換え
- アップロード前に確認ダイアログ表示：「既存データは全て削除されます。本当にアップロードしますか？」
- バリデーション：
  - 必須項目チェック（全項目必須）
  - クラウドサーバー名：「ニフクラ」または「AWS」のみ許可
  - スペック名：半角英数記号、最大30文字
  - 料金：数値形式チェック
    - ニフクラ：整数値（小数第一位を切り捨て）
    - AWS：小数第四位まで（小数第五位を切り捨て）
  - スペック名の重複チェック（同じクラウドサーバー内で重複不可）
- バリデーションエラー時はアップロードを中止し、エラー内容を表示

#### バリデーション

- スペック名の重複チェック（同じクラウドサーバー内で重複不可）
- クラウドサーバー名：「ニフクラ」または「AWS」のみ
- スペック名：半角英数記号、最大30文字
- 料金：数値のみ
  - ニフクラ：整数値（小数第一位を切り捨て）
  - AWS：小数第四位まで（小数第五位を切り捨て）

#### 料金表示ルール

- ニフクラ：「¥」を先頭に付与、整数表示（例：¥100）
- AWS：「$」を先頭に付与、小数第四位まで表示（例：$0.0416）

#### 権限制御

- 管理者・一般ユーザー両方アクセス可能

### 2.9 休日マスタ編集画面

#### 機能概要

- 土日以外の休日（祝日、会社指定休日）を管理
- インライン編集形式
- CSV一括ダウンロード・アップロード機能

#### 画面要素

- 休日マスタ一覧表
  - 日付（yyyy/mm/dd）
  - 休日名
  - 「編集」ボタン（各行）
  - 「削除」ボタン（各行）
- 「追加」ボタン（表の末尾）
- 「CSVダウンロード」ボタン
- 「CSVアップロード」ボタン

#### 操作

- 追加：表の末尾に新規行を追加、インライン編集
- 編集：該当行をインライン編集モードに変更
- 削除：物理削除、確認ダイアログ表示

#### CSVダウンロード機能

- CSV形式：日付（yyyy/mm/dd）, 休日名
- 現在登録されている全データをCSV形式でダウンロード
- ファイル名：holiday_masters_YYYYMMDD_HHmmss.csv

#### CSVアップロード機能

- CSV形式：日付（yyyy/mm/dd）, 休日名
- アップロードにより既存データを全て物理削除し、CSVの内容で置き換え
- アップロード前に確認ダイアログ表示：「既存データは全て削除されます。本当にアップロードしますか？」
- バリデーション：
  - 必須項目チェック（全項目必須）
  - 文字数制限チェック（休日名：最大255文字）
  - 日付形式チェック（yyyy/mm/dd）
  - 日付の重複チェック
- バリデーションエラー時はアップロードを中止し、エラー内容を表示

#### バリデーション

- 日付形式チェック（yyyy/mm/dd）
- 日付の重複チェック
- 休日名：最大255文字

#### 権限制御

- 管理者・一般ユーザー両方アクセス可能

### 2.10 サーバー名マスタ編集画面

#### 機能概要

- クラウドサーバー別のサーバー名を管理
- インライン編集形式
- CSV一括ダウンロード・アップロード機能

#### 画面要素

- サーバー名マスタ一覧表
  - クラウドサーバー名（ニフクラ/AWS）
  - サーバー名
  - 「編集」ボタン（各行）
  - 「削除」ボタン（各行）
- 「追加」ボタン（表の末尾）
- 「CSVダウンロード」ボタン
- 「CSVアップロード」ボタン

#### 操作

- 追加：表の末尾に新規行を追加、インライン編集
- 編集：該当行をインライン編集モードに変更
- 削除：物理削除、確認ダイアログ表示

#### CSVダウンロード機能

- CSV形式：クラウドサーバー名, サーバー名
  - クラウドサーバー名：「ニフクラ」または「AWS」
- 現在登録されている全データをCSV形式でダウンロード
- ファイル名：server_name_masters_YYYYMMDD_HHmmss.csv

#### CSVアップロード機能

- CSV形式：クラウドサーバー名, サーバー名
  - クラウドサーバー名：「ニフクラ」または「AWS」
- アップロードにより既存データを全て物理削除し、CSVの内容で置き換え
- アップロード前に確認ダイアログ表示：「既存データは全て削除されます。本当にアップロードしますか？」
- バリデーション：
  - 必須項目チェック（全項目必須）
  - クラウドサーバー名：「ニフクラ」または「AWS」のみ許可
  - サーバー名：半角英数記号、最大30文字
  - サーバー名の重複チェック（同じクラウドサーバー内で重複不可）
- バリデーションエラー時はアップロードを中止し、エラー内容を表示

#### バリデーション

- サーバー名の重複チェック（同じクラウドサーバー内で重複不可）
- クラウドサーバー名：「ニフクラ」または「AWS」のみ
- サーバー名：半角英数記号、最大30文字

#### 権限制御

- 管理者・一般ユーザー両方アクセス可能

### 2.11 ユーザー管理画面

#### 機能概要

- ユーザーの追加、削除、権限変更を管理
- インライン編集形式

#### 画面要素

- ユーザー一覧表
  - ユーザー名
  - メールアドレス
  - 権限（管理者/一般）
  - 登録日時
  - 「権限変更」（インライン編集）
  - 「パスワードリセット」ボタン
  - 「削除」ボタン
- 「新規ユーザー追加」ボタン

#### 新規ユーザー追加

- ユーザー名、メールアドレス、権限を入力
- システムが仮パスワードをランダム生成
- 仮パスワードを画面に表示（管理者が別途ユーザーに伝える）

#### 権限変更

- インライン編集で「管理者」「一般」を切り替え

#### パスワードリセット

- ボタン押下で確認ダイアログ表示
- システムが仮パスワードをランダム生成
- 仮パスワードを画面に表示

#### 削除

- 論理削除
- 確認ダイアログ表示

#### 権限制御

- 管理者のみアクセス可能

### 2.12 ユーザー名変更画面

#### 機能概要

- ログイン中のユーザーが自分のユーザー名を変更

#### 画面要素

- 現在のユーザー名表示
- 新しいユーザー名入力欄
- 「変更」ボタン
- 「キャンセル」ボタン

#### バリデーション

- ユーザー名必須チェック

### 2.13 パスワード変更画面

#### 機能概要

- ログイン中のユーザーが自分のパスワードを変更

#### 画面要素

- 現在のパスワード入力欄
- 新しいパスワード入力欄
- 確認用パスワード入力欄
- 「変更」ボタン
- 「キャンセル」ボタン

#### バリデーション

- 現在のパスワード認証
- 新しいパスワードと確認用の一致チェック
- Firebase Authenticationの機能を利用

## 3. データベース設計

### 3.1 テーブル一覧

1. users（ユーザー）
2. projects（案件）
3. project_servers（案件のサーバー情報）
4. price_masters（料金マスタ）
5. holiday_masters（休日マスタ）
6. server_name_masters（サーバー名マスタ）

### 3.2 テーブル定義

#### users（ユーザー）

| カラム名 | 型 | NULL | デフォルト | 説明 |
|---------|-----|------|-----------|------|
| id | BIGINT UNSIGNED | NO | AUTO_INCREMENT | 主キー |
| firebase_uid | VARCHAR(128) | NO | - | Firebase UID |
| name | VARCHAR(255) | NO | - | ユーザー名 |
| email | VARCHAR(255) | NO | - | メールアドレス |
| role | ENUM('admin', 'general') | NO | 'general' | 権限 |
| is_deleted | BOOLEAN | NO | FALSE | 削除フラグ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 更新日時 |

**インデックス**
- UNIQUE: firebase_uid
- UNIQUE: email

#### projects（案件）

| カラム名 | 型 | NULL | デフォルト | 説明 |
|---------|-----|------|-----------|------|
| id | BIGINT UNSIGNED | NO | AUTO_INCREMENT | 主キー |
| user_id | BIGINT UNSIGNED | NO | - | ユーザーID（外部キー） |
| name | VARCHAR(128) | NO | - | 案件名 |
| budget_code | VARCHAR(7) | NO | - | 予算コード |
| is_deleted | BOOLEAN | NO | FALSE | 削除フラグ |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 更新日時 |

**インデックス**
- FOREIGN KEY: user_id → users(id)

#### project_servers（案件のサーバー情報）

| カラム名 | 型 | NULL | デフォルト | 説明 |
|---------|-----|------|-----------|------|
| id | BIGINT UNSIGNED | NO | AUTO_INCREMENT | 主キー |
| project_id | BIGINT UNSIGNED | NO | - | 案件ID（外部キー） |
| cloud_server | ENUM('ニフクラ', 'AWS') | NO | - | クラウドサーバー名 |
| server_name | VARCHAR(30) | NO | - | サーバー名 |
| spec_before | VARCHAR(30) | NO | - | 変更前スペック |
| spec_after | VARCHAR(30) | NO | - | 変更後スペック |
| start_date | DATE | NO | - | スペックアップ開始日 |
| end_date | DATE | NO | - | スペックアップ終了日 |
| operating_hours | ENUM('9to18', '24hours') | NO | - | 稼働時間 |
| price_before_per_day | DECIMAL(10, 4) | NO | - | スペックアップ前金額（1日あたり、税抜き） |
| price_after_per_day | DECIMAL(10, 4) | NO | - | スペックアップ後金額（1日あたり、税抜き） |
| price_diff_per_day | DECIMAL(10, 4) | NO | - | スペックアップ差額（1日あたり、税抜き） |
| business_days | INT | NO | - | スペックアップ日数（営業日ベース） |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 更新日時 |

**インデックス**
- FOREIGN KEY: project_id → projects(id)

#### price_masters（料金マスタ）

| カラム名 | 型 | NULL | デフォルト | 説明 |
|---------|-----|------|-----------|------|
| id | BIGINT UNSIGNED | NO | AUTO_INCREMENT | 主キー |
| cloud_server | ENUM('ニフクラ', 'AWS') | NO | - | クラウドサーバー名 |
| spec_name | VARCHAR(30) | NO | - | スペック名 |
| price_per_hour | DECIMAL(10, 4) | NO | - | 1時間あたりの料金（税抜き、ニフクラ：整数、AWS：小数第四位まで） |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 更新日時 |

**インデックス**
- UNIQUE: (cloud_server, spec_name)

#### holiday_masters（休日マスタ）

| カラム名 | 型 | NULL | デフォルト | 説明 |
|---------|-----|------|-----------|------|
| id | BIGINT UNSIGNED | NO | AUTO_INCREMENT | 主キー |
| holiday_date | DATE | NO | - | 休日日付 |
| holiday_name | VARCHAR(255) | NO | - | 休日名 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 更新日時 |

**インデックス**
- UNIQUE: holiday_date

#### server_name_masters（サーバー名マスタ）

| カラム名 | 型 | NULL | デフォルト | 説明 |
|---------|-----|------|-----------|------|
| id | BIGINT UNSIGNED | NO | AUTO_INCREMENT | 主キー |
| cloud_server | ENUM('ニフクラ', 'AWS') | NO | - | クラウドサーバー名 |
| server_name | VARCHAR(30) | NO | - | サーバー名 |
| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 作成日時 |
| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | 更新日時 |

**インデックス**
- UNIQUE: (cloud_server, server_name)

### 3.3 ER図（テキスト表現）

```
users (1) ----< (N) projects (1) ----< (N) project_servers
```

- 1人のユーザーは複数の案件を持つ
- 1つの案件は複数のサーバー情報を持つ
- price_masters、holiday_masters、server_name_mastersは独立したマスタテーブル

## 4. API仕様

### 4.1 認証API

Firebase Authenticationを使用

#### サインアップ

- **メソッド**: POST
- **エンドポイント**: Firebase Authentication API
- **パラメータ**: email, password, name
- **処理**: Firebase側でユーザー作成後、usersテーブルにレコード追加

#### ログイン

- **メソッド**: POST
- **エンドポイント**: Firebase Authentication API
- **パラメータ**: email, password
- **処理**: Firebase側でトークン発行

#### パスワードリセット

- **メソッド**: POST
- **エンドポイント**: Firebase Authentication API
- **パラメータ**: email
- **処理**: Firebase側でリセットメール送信

### 4.2 案件API

#### 案件一覧取得

- **メソッド**: GET
- **エンドポイント**: `/api/projects`
- **パラメータ**: 
  - my_only (boolean): マイ案件のみ表示フラグ
- **レスポンス**: 案件一覧（サーバー情報含む）

#### 案件詳細取得

- **メソッド**: GET
- **エンドポイント**: `/api/projects/{id}`
- **レスポンス**: 案件詳細（サーバー情報含む）

#### 案件登録

- **メソッド**: POST
- **エンドポイント**: `/api/projects`
- **パラメータ**:
  - name (string): 案件名
  - budget_code (string): 予算コード
  - servers (array): サーバー情報の配列
- **レスポンス**: 登録された案件情報

#### 案件更新

- **メソッド**: PUT
- **エンドポイント**: `/api/projects/{id}`
- **パラメータ**: 案件登録と同じ
- **レスポンス**: 更新された案件情報

#### 案件削除（論理削除）

- **メソッド**: DELETE
- **エンドポイント**: `/api/projects/{id}`
- **レスポンス**: 削除成功メッセージ

### 4.3 料金計算API

#### 料金計算

- **メソッド**: POST
- **エンドポイント**: `/api/calculate-price`
- **パラメータ**:
  - cloud_server (string): クラウドサーバー名
  - spec_before (string): 変更前スペック
  - spec_after (string): 変更後スペック
  - start_date (date): 開始日
  - end_date (date): 終了日
  - operating_hours (string): 稼働時間
- **レスポンス**:
  - price_before_per_day (decimal): 1日あたり前金額
  - price_after_per_day (decimal): 1日あたり後金額
  - price_diff_per_day (decimal): 1日あたり差額
  - business_days (int): 営業日数

### 4.4 料金マスタAPI

#### 料金マスタ一覧取得

- **メソッド**: GET
- **エンドポイント**: `/api/price-masters`
- **レスポンス**: 料金マスタ一覧

#### 料金マスタ登録

- **メソッド**: POST
- **エンドポイント**: `/api/price-masters`
- **パラメータ**:
  - cloud_server (string): クラウドサーバー名
  - spec_name (string): スペック名
  - price_per_hour (decimal): 1時間あたり料金
- **レスポンス**: 登録された料金マスタ

#### 料金マスタ更新

- **メソッド**: PUT
- **エンドポイント**: `/api/price-masters/{id}`
- **パラメータ**: 登録と同じ
- **レスポンス**: 更新された料金マスタ

#### 料金マスタ削除（物理削除）

- **メソッド**: DELETE
- **エンドポイント**: `/api/price-masters/{id}`
- **レスポンス**: 削除成功メッセージ

#### 料金マスタCSVダウンロード

- **メソッド**: GET
- **エンドポイント**: `/api/price-masters/download-csv`
- **レスポンス**: CSVファイル（クラウドサーバー名, スペック名, 料金）

#### 料金マスタCSVアップロード

- **メソッド**: POST
- **エンドポイント**: `/api/price-masters/upload-csv`
- **パラメータ**: csv_file (file)
- **処理**: 既存データを全削除後、CSVデータを一括登録
- **レスポンス**: 登録件数、バリデーションエラー（ある場合）

### 4.5 休日マスタAPI

#### 休日マスタ一覧取得

- **メソッド**: GET
- **エンドポイント**: `/api/holiday-masters`
- **レスポンス**: 休日マスタ一覧

#### 休日マスタ登録

- **メソッド**: POST
- **エンドポイント**: `/api/holiday-masters`
- **パラメータ**:
  - holiday_date (date): 休日日付
  - holiday_name (string): 休日名
- **レスポンス**: 登録された休日マスタ

#### 休日マスタ更新

- **メソッド**: PUT
- **エンドポイント**: `/api/holiday-masters/{id}`
- **パラメータ**: 登録と同じ
- **レスポンス**: 更新された休日マスタ

#### 休日マスタ削除（物理削除）

- **メソッド**: DELETE
- **エンドポイント**: `/api/holiday-masters/{id}`
- **レスポンス**: 削除成功メッセージ

#### 休日マスタCSVダウンロード

- **メソッド**: GET
- **エンドポイント**: `/api/holiday-masters/download-csv`
- **レスポンス**: CSVファイル（日付, 休日名）

#### 休日マスタCSVアップロード

- **メソッド**: POST
- **エンドポイント**: `/api/holiday-masters/upload-csv`
- **パラメータ**: csv_file (file)
- **処理**: 既存データを全削除後、CSVデータを一括登録
- **レスポンス**: 登録件数、バリデーションエラー（ある場合）

### 4.6 サーバー名マスタAPI

#### サーバー名マスタ一覧取得

- **メソッド**: GET
- **エンドポイント**: `/api/server-name-masters`
- **レスポンス**: サーバー名マスタ一覧

#### サーバー名マスタ登録

- **メソッド**: POST
- **エンドポイント**: `/api/server-name-masters`
- **パラメータ**:
  - cloud_server (string): クラウドサーバー名
  - server_name (string): サーバー名
- **レスポンス**: 登録されたサーバー名マスタ

#### サーバー名マスタ更新

- **メソッド**: PUT
- **エンドポイント**: `/api/server-name-masters/{id}`
- **パラメータ**: 登録と同じ
- **レスポンス**: 更新されたサーバー名マスタ

#### サーバー名マスタ削除（物理削除）

- **メソッド**: DELETE
- **エンドポイント**: `/api/server-name-masters/{id}`
- **レスポンス**: 削除成功メッセージ

#### サーバー名マスタCSVダウンロード

- **メソッド**: GET
- **エンドポイント**: `/api/server-name-masters/download-csv`
- **レスポンス**: CSVファイル（クラウドサーバー名, サーバー名）

#### サーバー名マスタCSVアップロード

- **メソッド**: POST
- **エンドポイント**: `/api/server-name-masters/upload-csv`
- **パラメータ**: csv_file (file)
- **処理**: 既存データを全削除後、CSVデータを一括登録
- **レスポンス**: 登録件数、バリデーションエラー（ある場合）

### 4.7 稟議依頼/インフラ依頼API

#### 稟議依頼作成

- **メソッド**: POST
- **エンドポイント**: `/api/approval-request`
- **パラメータ**:
  - target_year (int): 対象年
  - target_month (int): 対象月
- **レスポンス**: 稟議依頼文書（プレーンテキスト）

#### インフラ依頼作成

- **メソッド**: POST
- **エンドポイント**: `/api/infra-request`
- **パラメータ**:
  - target_year (int): 対象年
  - target_month (int): 対象月
- **レスポンス**: インフラ依頼文書（プレーンテキスト）

### 4.8 ユーザー管理API

#### ユーザー一覧取得

- **メソッド**: GET
- **エンドポイント**: `/api/users`
- **レスポンス**: ユーザー一覧

#### ユーザー登録

- **メソッド**: POST
- **エンドポイント**: `/api/users`
- **パラメータ**:
  - name (string): ユーザー名
  - email (string): メールアドレス
  - role (string): 権限
- **レスポンス**: 登録されたユーザー情報、仮パスワード

#### ユーザー更新（権限変更、ユーザー名変更）

- **メソッド**: PUT
- **エンドポイント**: `/api/users/{id}`
- **パラメータ**:
  - name (string): ユーザー名
  - role (string): 権限
- **レスポンス**: 更新されたユーザー情報

#### ユーザー削除（論理削除）

- **メソッド**: DELETE
- **エンドポイント**: `/api/users/{id}`
- **レスポンス**: 削除成功メッセージ

#### パスワードリセット

- **メソッド**: POST
- **エンドポイント**: `/api/users/{id}/reset-password`
- **レスポンス**: 仮パスワード

## 5. 開発フェーズ

### フェーズ1: 認証機能 + 案件CRUD + 料金計算

1. Firebase Authentication連携
2. ログイン/サインアップ画面
3. 共通ヘッダー
4. TOP画面（一覧表示）
5. 案件登録画面
6. 案件編集画面
7. 料金計算機能（営業日計算含む）

### フェーズ2: マスタ管理

1. 料金マスタ編集画面（CSV DL/UL機能含む）
2. 休日マスタ編集画面（CSV DL/UL機能含む）
3. サーバー名マスタ編集画面（CSV DL/UL機能含む）

### フェーズ3: 稟議依頼/インフラ依頼

1. 稟議依頼作成画面
2. インフラ依頼作成画面
3. 案件横断集計ロジック（重複除外）

### フェーズ4: ユーザー管理

1. ユーザー管理画面
2. ユーザー名変更画面
3. パスワード変更画面

## 6. テストデータ

Laravelのシーダーで以下を投入：

- ユーザー（管理者1名、一般ユーザー2名）
- 案件（3件程度、各案件に2-3サーバー）
- 料金マスタ（ニフクラ/AWSの主要スペック10件程度）
- 休日マスタ（2026年の祝日）
- サーバー名マスタ（ニフクラ/AWSのサーバー名10件程度）
